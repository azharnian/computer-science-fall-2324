!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6fcef7cd-50fe-4c7e-9386-57db112d4d02",e._sentryDebugIdIdentifier="sentry-dbid-6fcef7cd-50fe-4c7e-9386-57db112d4d02")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"468e0ce18ce8eaa072d85361b0e2c2d814ed5dca"},(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0vQq":function(e,t,a){"use strict";a.d(t,"a",function(){return r});var i=a("2Vo4"),s=a("8Y7J");let r=(()=>{class e{constructor(){this._display=new i.a(!1),this.display=this._display.asObservable()}updateDisplay(e){this._display.next(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},"3aQD":function(e,t,a){"use strict";a.d(t,"a",function(){return x});var i=a("SVse"),s=a("8Y7J"),r=a("wMn0"),o=a("XNiG"),n=a("Kj3r"),c=a("lJxs"),l=a("W8+8"),p=a("IheW");let h=(()=>{class e{constructor(e){this.http=e,this.apiEndpoint=Object(l.a)(),this.zoomTo$=new o.a,this._roundCoord=(e,t,a=!0)=>{let i=.01;return t<=3?i=40:t<=5?i=20:t<=8?i=10:t<=10?i=5:t<=12&&(i=.1),this._round(e,i,a)},this._round=(e,t,a)=>{let i=a?Math.floor(e/t)*t:Math.ceil(e/t)*t;if(t<1){const a=Math.ceil(-Math.log10(t));i=Number(e.toFixed(a))}return i},this._clamp=(e,t)=>t>0?Math.min(e,t):Math.max(e,t),this._fireWithReducedZoom=e=>Object.assign(Object.assign({},e),{zoomLevel:e.zoomLevel-2})}getPlacesMap(e,t=!1){let a=`${this.apiEndpoint}places/map?bbox=${e.join(",")}`;return t&&(a=this._addConcentrationParam(a)),this.http.get(a)}getClusteredPlaces(e,t,a=!1){const i=this._getReducedZoom(t);let s=`${this.apiEndpoint}places/map/clusters?bbox=${e.join(",")}&zoomLevel=${i}`;return a&&(s=this._addConcentrationParam(s)),this.http.get(s).pipe(Object(c.a)(({total:e,markers:t})=>({total:e,markers:t.map(this._mapClusteredMarker)})))}getAlertMarkers(e,t){let a=`${this.apiEndpoint}places/map/keyMarkers?bbox=${e.join(",")}&zoomLevel=${t}`;return this.http.get(a)}_getReducedZoom(e){return e<=3?3:4==e?4:5==e?3:e<=8?4:e<=12?6:12}_addConcentrationParam(e){return`${e}&fields=conc`}_mapClusteredMarker(e){const{id:t,name:a,type:i,aqi:s,coordinates:r,concentration:o}=e;return{id:t,name:a,type:i,aqi:s,coordinates:r,concentration:o}}getFirePins(e,t,a=!0){let i=`${this.apiEndpoint}fires/map?bbox=${e.join(",")}&zoomLevel=${t}`;return a&&(i=`${i}&getKeyFires=true`),this.http.get(i).pipe(Object(c.a)(e=>e.map(this._fireWithReducedZoom)))}getMapBounds(e){if(e){const t=e.getBounds(),a=t.getNorth()<90?t.getNorth():90;return[t.getWest()>-180?t.getWest():-180,t.getSouth()>-90?t.getSouth():-90,t.getEast()<180?t.getEast():180,a]}}getRoundedMapBounds(e,t){const a=[-180,-90,180,90];return this.getMapBounds(e).map((e,i)=>{const s=a[i],r=this._roundCoord(e,t,s<0);return this._clamp(r,s)})}}return e.\u0275fac=function(t){return new(t||e)(s.kc(p.b))},e.\u0275prov=s.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var d=a("xvjA"),m=a("BIJc"),u=a("0vQq"),v=a("mrSG"),y=a("LRne"),g=a("pLZG"),b=a("eIep"),f=a("vkgz"),S=a("mov8"),L=a("AuMg"),M=a("f/gZ"),E=a("OQrI"),k=a("KUxh"),C=a("aWBA"),O=a("PJha");const P=["*"];var w=function(e){return e[e.NONE=0]="NONE",e[e.CREATE=1]="CREATE",e[e.UPDATE=2]="UPDATE",e[e.ADD=3]="ADD",e[e.RECREATE=4]="RECREATE",e[e.REMOVE=5]="REMOVE",e}({});let A=(()=>{class e{constructor(e,t,a,i,r,n,c,l){this.platformId=e,this.mapService=t,this.osmTileService=a,this.placesLayerService=i,this.osmPlacesZoomService=r,this.mapZoomService=n,this.leafletService=c,this.placesLayerSelectionService=l,this.isUNEPMap=!1,this.mapOptions={zoom:3,minZoom:3,maxZoom:15,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:[[-85,-180],[85,180]]},this.center=[11.89735,.852629],this.heatWindStates={heatmap:!0,wind:!0,population:!1},this.placeState=!0,this.isStaticPlaceBBox=!1,this.keyboard=!0,this.mapLoaded=new s.r,this.mapMoveStart=new s.r,this.mapMoveEnd=new s.r,this.mapResize=new s.r,this.mapClicked=new s.r,this.placeClicked=new s.r,this.placeLayer={},this.moveEndRequest=new o.a,this.PLACES_DEBOUNCE_MS=500,this.onMarkerClickCb=(e,t)=>{this.placeClicked.emit({event:e,aqiMarker:t})},this._getMapZoom=()=>{var e;return null===(e=this.map.mapObj)||void 0===e?void 0:e.getZoom()},this.requestPlaces=e=>this.mapService.getPlacesMap(e,this.isUNEPMap),this.requestClusteredPlaces=(e,t)=>this.mapService.getClusteredPlaces(e,t,this.isUNEPMap),this.removeLayerIfExists=e=>{var t;return null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.remove()},this.bboxIsWithinPrevious=(e,t)=>{if(!e)return!1;const[a,i,s,r]=e,[o,n,c,l]=t;return o>=a&&c<=s&&l<=r&&n>=i}}ngOnInit(){Object(i.B)(this.platformId)&&(this.registerPlacesLayerSub(),this._registerZoomToPlaceSub(),this.registerZoomToMarkerSub())}registerPlacesLayerSub(){this.placesClusterStrategy===S.d.FRONTEND?this._registerClientPlacesClusteringSub():this._registerServerPlacesClusteringSub()}_registerClientPlacesClusteringSub(){const e=this.moveEndRequest.pipe(Object(n.a)(this.PLACES_DEBOUNCE_MS),Object(c.a)(()=>{const e=this._getMapZoom();return{bbox:this.mapService.getRoundedMapBounds(this.map.mapObj,e),zoom:e}})).pipe(Object(c.a)(({bbox:e,zoom:t})=>({layerAction:this.getLayerAction(this.placeLayer.layer,this.map.mapObj,this.placeState,t,this.placesBbox,e),zoom:t,bbox:e})),Object(g.a)(({layerAction:e})=>e!=w.NONE),Object(b.a)(({bbox:e,zoom:t,layerAction:a})=>a==w.ADD||a==w.RECREATE?Object(y.a)({markers:this.markers,zoom:t,layerAction:a}):a==w.CREATE||a==w.UPDATE?this.requestPlaces(e).pipe(Object(c.a)(i=>({markers:i,layerAction:a,zoom:t,bbox:e})),Object(f.a)(({bbox:e})=>this.placesBbox=e)):a==w.REMOVE?Object(y.a)({zoom:t,layerAction:a,markers:this.markers}):this.requestPlaces(e).pipe(Object(c.a)(i=>({markers:i,layerAction:a,zoom:t,bbox:e})))));this.placesLayerSub=e.subscribe(({zoom:e,layerAction:t,markers:a})=>{switch(t){case w.REMOVE:this.removeLayerIfExists(this.placeLayer);break;case w.CREATE:case w.RECREATE:this.createPlacesLayer(a);break;case w.ADD:this.addLayerToMap(this.map,this.placeLayer);break;case w.UPDATE:this.updatePlacesLayer(a,e)}this.zoom=e,this.markers=a})}_registerZoomToPlaceSub(){this.zoomToMarkerSub=this.osmPlacesZoomService.zoomToPlace$.subscribe(e=>Object(v.a)(this,void 0,void 0,function*(){}))}_registerServerPlacesClusteringSub(){const e=this.moveEndRequest.pipe(Object(n.a)(this.PLACES_DEBOUNCE_MS),Object(c.a)(()=>{const e=this._getMapZoom();return{bbox:this.mapService.getRoundedMapBounds(this.map.mapObj,13),zoom:e}})).pipe(Object(c.a)(({bbox:e,zoom:t})=>({bbox:e,zoom:t,layerAction:this.placeState?w.CREATE:w.REMOVE})),Object(b.a)(({bbox:e,zoom:t,layerAction:a})=>a===w.REMOVE?Object(y.a)({mapClusters:null,zoom:t,layerAction:a}):this.requestClusteredPlaces(e,t).pipe(Object(c.a)(e=>({mapClusters:e,zoom:t,layerAction:a})))));this.placesLayerSub=e.subscribe(({mapClusters:e,zoom:t,layerAction:a})=>{var i,s;a===w.REMOVE?this.removeLayerIfExists(this.placeLayer):(this.zoom=t,null===(s=null===(i=this.placeLayer)||void 0===i?void 0:i.layer)||void 0===s||s.remove(),this.placeLayer.layer=this.placesLayerService.createPlacesLayerFromClusteredMarkers(this.map.L,e.markers,this.onMarkerClickCb,this.map.mapObj,{isUNEP:this.isUNEPMap,disableSmallPin:!1}),this.addLayerToMap(this.map,this.placeLayer))})}registerZoomToMarkerSub(){this.mapService.zoomTo$.subscribe(e=>Object(v.a)(this,void 0,void 0,function*(){try{const t=this.leafletService.getMarkerFromCluster(this.placeLayer.layer,e);yield this.mapZoomService.zoomToShowMarker(this.map.mapObj,this.placeLayer.layer,t),this.placesLayerSelectionService.selectPlace(this.map.L,t,this._getMapZoom(),{isUNEP:this.isUNEPMap,disableSmallPin:!1})}catch(t){console.error(t)}}))}ngOnChanges(e){e.placeState&&this.resolvePlaceLayer(),e.keyboard&&(this.placeLayer.options={keyboard:this.keyboard})}resolvePlaceLayer(){this.placeState&&this.map&&(this.isStaticPlaceBBox||this.moveEndRequest.next(!0),this.isStaticPlaceBBox&&(this.placeLayer.layer&&this.addLayerToMap(this.map,this.placeLayer),this.placeLayer.layer||this.moveEndRequest.next(!0))),this.placeState||this.moveEndRequest.next(!0)}getLayerAction(e,t,a,i,s,r){const o=this.osmTileService.getPinUpdate(this.zoom,i),n=this.bboxIsWithinPrevious(s,r);return a?e?o==d.b.REGULAR_TO_SMALL?w.CREATE:o==d.b.SMALL_TO_REGULAR?w.RECREATE:e&&!t.hasLayer(e)?w.ADD:n?w.NONE:w.UPDATE:w.CREATE:w.REMOVE}getMapBounds(){const e=this.map.mapObj.getBounds(),t=e.getNorth();return[e.getWest(),e.getSouth(),e.getEast(),t]}createPlacesLayer(e){!this.isStaticPlaceBBox&&this.placeLayer.layer&&(this.placeLayer.layer.remove(),this.placeLayer.layer=null),this.placeLayer.layer=this.osmTileService.createPlaceLayer(this.map.L,e,this.onMarkerClickCb,this.map.mapObj,{isUNEP:this.isUNEPMap}),this.keyboard||this.placeLayer.layer.on("add",()=>{const e=document.getElementsByClassName("leaflet-marker-icon");for(let t=0;t<e.length;t++)e[t].removeAttribute("tabindex")}),this.addLayerToMap(this.map,this.placeLayer)}updatePlacesLayer(e,t){var a;const i={isUNEP:this.isUNEPMap,disableSmallPin:!1},s=null===(a=this.placeLayer)||void 0===a?void 0:a.layer,r=null==s?void 0:s.getLayers();if(!r||!e)return;const o=this._markersToAdd(r,e),n=this.placesLayerService.createAqiMarkers(this.map.L,o,this.onMarkerClickCb,i,t),c=this._markersToRemove(r,e);this.placeLayer.layer.removeLayers(c),this.placeLayer.layer.addLayers(n)}addLayerToMap(e,t){try{t.layer.addTo(e.mapObj)}catch(a){console.error("error when adding layer to map"),console.error(a)}}_markersToAdd(e,t){return t.filter(t=>!e.find(e=>e.options.id===t.id))}_markersToRemove(e,t){return e.filter(e=>!t.find(t=>t.id===e.options.id))}onMapLoaded(e){this.map=e,this.zoom=this.map.mapObj.getZoom(),this.resolvePlaceLayer(),this.mapLoaded.emit(e)}onMapMoveStart(e){this.mapMoveStart.emit(e)}onMapMoveEnd(e){this.resolvePlaceLayer(),this.mapMoveEnd.emit(e)}onMapResize(e){this.mapResize.emit(e)}onMapClicked(e){this.mapClicked.emit(e)}ngOnDestroy(){var e,t;null===(e=this.placesLayerSub)||void 0===e||e.unsubscribe(),null===(t=this.zoomToMarkerSub)||void 0===t||t.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(s.ac(s.J),s.ac(h),s.ac(d.a),s.ac(L.a),s.ac(M.a),s.ac(E.a),s.ac(k.a),s.ac(C.a))},e.\u0275cmp=s.Ub({type:e,selectors:[["app-osm-heat-wind-places"]],inputs:{isUNEPMap:"isUNEPMap",mapOptions:"mapOptions",center:"center",heatWindStates:"heatWindStates",placeState:"placeState",isStaticPlaceBBox:"isStaticPlaceBBox",staticPlaceBBox:"staticPlaceBBox",keyboard:"keyboard",placesClusterStrategy:"placesClusterStrategy"},outputs:{mapLoaded:"mapLoaded",mapMoveStart:"mapMoveStart",mapMoveEnd:"mapMoveEnd",mapResize:"mapResize",mapClicked:"mapClicked",placeClicked:"placeClicked"},features:[s.Kb],ngContentSelectors:P,decls:2,vars:3,consts:[[3,"mapOptions","center","heatWindStates","mapLoaded","mapMoveStart","mapMoveEnd","mapResize","mapClicked"]],template:function(e,t){1&e&&(s.Ac(),s.gc(0,"app-osm-heat-wind",0),s.oc("mapLoaded",function(e){return t.onMapLoaded(e)})("mapMoveStart",function(e){return t.onMapMoveStart(e)})("mapMoveEnd",function(e){return t.onMapMoveEnd(e)})("mapResize",function(e){return t.onMapResize(e)})("mapClicked",function(e){return t.onMapClicked(e)}),s.zc(1),s.fc()),2&e&&s.Bc("mapOptions",t.mapOptions)("center",t.center)("heatWindStates",t.heatWindStates)},directives:[O.a],styles:[""]}),e})();const _=["*"];let x=(()=>{class e{constructor(e,t,a,i,r){this.platformId=e,this.mapService=t,this.osmTileService=a,this.placesMarkerService=i,this.service=r,this.isUNEPMap=!1,this.mapOptions={zoom:3,minZoom:3,maxZoom:15,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:[[-85,-180],[85,180]]},this.center=[11.89735,.852629],this.heatWindStates={heatmap:!0,wind:!0,population:!1},this.placeState=!0,this.fireState=!0,this.alertState=!0,this.isStaticPlaceBBox=!1,this.keyboard=!0,this.mapLoaded=new s.r,this.mapMoveStart=new s.r,this.mapMoveEnd=new s.r,this.mapResize=new s.r,this.mapClicked=new s.r,this.placeClicked=new s.r,this.fireClicked=new s.r,this.alertClicked=new s.r,this.fireLayer={},this.alertLayer={},this.moveEndRequest=new o.a}ngOnInit(){Object(i.B)(this.platformId)&&(this.includedKeyFire=!this.isUNEPMap,this.moveEndSubscription=this.moveEndRequest.pipe(Object(n.a)(500)).subscribe(e=>{this.fireState&&this.requestFires(e),this.includedKeyFire&&this.alertState&&this._requestAlerts(e)}))}ngOnChanges(e){this.map&&(this.includedKeyFire&&e.alertState?this._resolveAlert():e.fireState&&this.resolveFireLayer()),e.keyboard&&(this.fireLayer.options={keyboard:this.keyboard})}_requestAlerts(e=null){const t=this.map.mapObj.getZoom();e||(e=this.mapService.getRoundedMapBounds(this.map.mapObj,t)),this.mapService.getAlertMarkers(e,t).subscribe(e=>{this._removeAlerts(),e.length>0&&this._createAlertLayer(e),this.service.updateDisplay(e.length>0)})}_resolveAlert(e=null){this.alertState?this.moveEndRequest.next(e):this._removeAlerts()}_removeAlerts(){this.alertLayer.layer&&(this.alertLayer.layer.remove(),this.alertLayer.layer=null)}_createAlertLayer(e){this.alertLayer.layer=this.osmTileService.generateLayer("customMarker",this.map,this.alertLayer.options,e,(e,t)=>this.alertClicked.emit({alert:t})),this.alertLayer.layer.addTo(this.map.mapObj)}resolveFireLayer(e=null){this.fireState?this.moveEndRequest.next(e):this._removeFireLayer()}requestFires(e=null){const t=this.map.mapObj.getZoom();e||(e=this.mapService.getRoundedMapBounds(this.map.mapObj,t)),this.mapService.getFirePins(e,t,this.includedKeyFire).subscribe(e=>{const t=this.includedKeyFire?e:e.filter(e=>e.type!==r.a.KEY_FIRE);this._removeFireLayer(),this._createFireLayer(t),this.includedKeyFire&&this._setAlerts(e)})}_createFireLayer(e){this.fireLayer.layer=this.osmTileService.generateLayer("fires",this.map,this.fireLayer.options,e,(e,t)=>this.handleFireClicked(t.type,e,t)),this.fireLayer.layer.addTo(this.map.mapObj)}_removeFireLayer(){this.fireLayer.layer&&(this.fireLayer.layer.remove(),this.fireLayer.layer=null)}handleFireClicked(e,t,a){a.clustered&&this.onFireClusterClicked(a),a.clustered||this.onFireClicked(e,t,a)}onMapLoaded(e){this.map=e,this.fireZoomLevel=this.map.mapObj.getZoom(),this.fireBBox=this.mapService.getRoundedMapBounds(this.map.mapObj,this.fireZoomLevel),this.resolveFireLayer(),this.includedKeyFire&&this._resolveAlert(),this.mapLoaded.emit(e)}onMapMoveStart(e){this._removeFireLayer(),this._removeAlerts(),this.mapMoveStart.emit(e)}onMapMoveEnd(e){this.map&&(this.resolveFireLayer(),this._resolveAlert()),this.mapMoveEnd.emit(e)}onMapResize(e){this._removeFireLayer(),this._removeAlerts(),this.mapResize.emit(e)}onMapClicked(e){this.mapClicked.emit(e)}onFireClusterClicked(e){const t=[e.bbox.NElat,e.bbox.SWlon,e.bbox.SWlat,e.bbox.NElon],a=e.zoomLevel;this.map.mapObj.flyTo(e.location.reverse(),a),this.fireBBox=t,this.fireZoomLevel=a,this.resolveFireLayer(this.fireBBox)}onFireClicked(e,t,a){var i;if(this.includedKeyFire&&e===r.a.KEY_FIRE){const e=this.osmTileService.mapFireToAlert(a);this.alertClicked.emit({alert:e})}else{if(e===r.a.FIRE){this.removeSelectedPlace(this.osmTileService.selectedMarker);const e=t.target._icon;e.classList.add("fire-pin"),e.classList.add("selected-pin"),setTimeout(()=>{e.classList.remove("fire-pin"),e.classList.remove("selected-pin")},500)}const s=null===(i=this._alerts)||void 0===i?void 0:i.find(e=>{var t;return(null==e?void 0:e.id)===(null===(t=null==a?void 0:a.nearbyEvent)||void 0===t?void 0:t.id)});this.fireClicked.emit({event:t,fireDetail:Object.assign(Object.assign({},a),{nearbyEvent:s})})}}onPlaceClicked(e){this.placeClicked.emit(e)}removeSelectedPlace(e){e&&e.marker&&e.marker.setIcon(this.map.L.divIcon({iconSize:[0,0],html:this.placesMarkerService.getMarkerHTML(!1,{className:e.className,displayValue:e.displayValue,itemAlt:e.itemAlt})}))}ngOnDestroy(){this.moveEndSubscription&&this.moveEndSubscription.unsubscribe()}_setAlerts(e){this._alerts=e.filter(e=>e.type===r.a.KEY_FIRE).map(e=>this.osmTileService.mapFireToAlert(e))}}return e.\u0275fac=function(t){return new(t||e)(s.ac(s.J),s.ac(h),s.ac(d.a),s.ac(m.a),s.ac(u.a))},e.\u0275cmp=s.Ub({type:e,selectors:[["app-osm-heat-wind-places-fires-alerts"]],inputs:{isUNEPMap:"isUNEPMap",mapOptions:"mapOptions",center:"center",heatWindStates:"heatWindStates",placeState:"placeState",fireState:"fireState",alertState:"alertState",isStaticPlaceBBox:"isStaticPlaceBBox",staticPlaceBBox:"staticPlaceBBox",keyboard:"keyboard",placesClusterStrategy:"placesClusterStrategy"},outputs:{mapLoaded:"mapLoaded",mapMoveStart:"mapMoveStart",mapMoveEnd:"mapMoveEnd",mapResize:"mapResize",mapClicked:"mapClicked",placeClicked:"placeClicked",fireClicked:"fireClicked",alertClicked:"alertClicked"},features:[s.Kb],ngContentSelectors:_,decls:2,vars:8,consts:[[3,"isUNEPMap","mapOptions","center","heatWindStates","placeState","staticPlaceBBox","keyboard","placesClusterStrategy","mapLoaded","mapMoveStart","mapMoveEnd","mapResize","mapClicked","placeClicked"]],template:function(e,t){1&e&&(s.Ac(),s.gc(0,"app-osm-heat-wind-places",0),s.oc("mapLoaded",function(e){return t.onMapLoaded(e)})("mapMoveStart",function(e){return t.onMapMoveStart(e)})("mapMoveEnd",function(e){return t.onMapMoveEnd(e)})("mapResize",function(e){return t.onMapResize(e)})("mapClicked",function(e){return t.onMapClicked(e)})("placeClicked",function(e){return t.onPlaceClicked(e)}),s.zc(1),s.fc()),2&e&&s.Bc("isUNEPMap",t.isUNEPMap)("mapOptions",t.mapOptions)("center",t.center)("heatWindStates",t.heatWindStates)("placeState",t.placeState)("staticPlaceBBox",t.staticPlaceBBox)("keyboard",t.keyboard)("placesClusterStrategy",t.placesClusterStrategy)},directives:[A],styles:[""]}),e})()},"82VU":function(e,t,a){"use strict";a.d(t,"a",function(){return u});var i=a("8Y7J"),s=a("hl0K"),r=a("SVse");function o(e,t){1&e&&i.cc(0)}const n=function(e,t){return{toggle:e,key:t}};function c(e,t){if(1&e&&(i.ec(0),i.dd(1,o,1,0,"ng-container",3),i.dc()),2&e){const e=t.$implicit;i.sc();const a=i.Oc(4);i.Mb(1),i.Bc("ngTemplateOutlet",a)("ngTemplateOutletContext",i.Ic(2,n,e.value,e.key))}}function l(e,t){if(1&e&&i.bc(0,"img",9),2&e){const e=i.sc(2),t=e.toggle,a=e.key;i.Bc("src",null==t.icon?null:t.icon.inactive,i.Vc)("alt",a+" inactive icon")}}function p(e,t){if(1&e&&i.bc(0,"img",9),2&e){const e=i.sc(2),t=e.toggle,a=e.key;i.Bc("src",null==t.icon?null:t.icon.active,i.Vc)("alt",a+" active icon")}}function h(e,t){if(1&e&&i.bc(0,"img",10),2&e){const e=i.sc(3);i.Bc("src",e.WHITE_CHECK,i.Vc)("alt",e.altTrans.checkIconAlt)}}function d(e,t){if(1&e){const e=i.hc();i.gc(0,"button",5),i.oc("click",function(){i.Sc(e);const t=i.sc().key;return i.sc().onButtonToggled(t)}),i.dd(1,l,1,2,"img",6),i.dd(2,p,1,2,"img",6),i.gc(3,"span",7),i.fd(4),i.fc(),i.dd(5,h,1,2,"img",8),i.fc()}if(2&e){const e=i.sc().toggle;i.Sb("active",e.active),i.Mb(1),i.Bc("ngIf",!e.active),i.Mb(1),i.Bc("ngIf",e.active),i.Mb(1),i.Cc("title",e.label),i.Mb(1),i.gd(e.label),i.Mb(1),i.Bc("ngIf",e.active)}}function m(e,t){1&e&&i.dd(0,d,6,7,"button",4),2&e&&i.Bc("ngIf",t.toggle.display)}let u=(()=>{class e{constructor(){this.WHITE_CHECK="assets/svg/ic-check-white.svg",this.trans=s.a.core.nav,this.altTrans=s.a.portal.imageAlt,this.defaultToggleButtons={place:{display:!1,active:!1,label:this.trans.airMonitors,icon:{active:"assets/svg/ic-pin-station-outline-white.svg",inactive:"assets/svg/ic-location-02-station-blue.svg"}},fire:{display:!1,active:!1,label:this.trans.fires,icon:{active:"assets/svg/ic-fire-outline-white.svg",inactive:"assets/svg/ic-fire-blue.svg"}},heatmap:{display:!1,active:!1,label:this.trans.airQuality,icon:{active:"assets/svg/ic-heatmap-white.svg",inactive:"assets/svg/ic-heatmap-blue.svg"}},population:{display:!1,active:!1,label:this.trans.population,icon:{active:"assets/svg/ic-population-outline-white.svg",inactive:"assets/svg/ic-population-blue.svg"}},wind:{display:!1,active:!1,label:this.trans.wind,icon:{active:"assets/svg/ic-wind-white.svg",inactive:"assets/svg/ic-wind-blue.svg"}},alert:{display:!1,active:!1,label:this.trans.alerts,icon:{active:"assets/svg/ic-warning-white-24.svg",inactive:"assets/svg/ic-warning-blue-24.svg"}}},this.align="left",this.buttonToggled=new i.r,this.keepOrderAsIs=(e,t)=>0}ngOnInit(){this.setToggleButtonsOptions()}setToggleButtonsOptions(){Object.entries(this.toggleButtons).forEach(([e,t])=>{this.toggleButtons[e]={display:t.display,active:t.active,label:t.label||this.defaultToggleButtons[e].label,icon:t.icon||this.defaultToggleButtons[e].icon}})}onButtonToggled(e){this.toggleButtons[e].active=!this.toggleButtons[e].active,this.buttonToggled.emit(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Ub({type:e,selectors:[["app-osm-toggle-buttons"]],inputs:{toggleButtons:"toggleButtons",align:"align"},outputs:{buttonToggled:"buttonToggled"},decls:5,vars:6,consts:[[1,"osm-toggle-button-wrapper"],[4,"ngFor","ngForOf"],["toggleButton",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","osm-toggle-button",3,"active","click",4,"ngIf"],[1,"osm-toggle-button",3,"click"],["class","osm-toggle-button-icon",3,"src","alt",4,"ngIf"],[1,"osm-toggle-button-text",3,"title"],["height","16","width","16",3,"src","alt",4,"ngIf"],[1,"osm-toggle-button-icon",3,"src","alt"],["height","16","width","16",3,"src","alt"]],template:function(e,t){1&e&&(i.gc(0,"div",0),i.dd(1,c,2,5,"ng-container",1),i.tc(2,"keyvalue"),i.fc(),i.dd(3,m,1,1,"ng-template",null,2,i.ed)),2&e&&(i.Sb("buttons-right","right"===t.align),i.Mb(1),i.Bc("ngForOf",i.vc(2,3,t.toggleButtons,t.keepOrderAsIs)))},directives:[r.n,r.t,r.o],pipes:[r.h],styles:[".osm-toggle-button[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:4px 12px 4px 8px;gap:4px;background:#fff;box-shadow:0 4px 8px -2px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.2);border-radius:13px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:none;font-weight:500;font-size:12px;line-height:18px;color:#475467;cursor:pointer}.osm-toggle-button[_ngcontent-%COMP%]:hover{background:#deefff}.osm-toggle-button.active[_ngcontent-%COMP%]{color:#fff;background:#0f3d68}.osm-toggle-button-icon[_ngcontent-%COMP%]{width:16px;height:16px}.osm-toggle-button-wrapper[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;gap:8px}.osm-toggle-button-wrapper.buttons-right[_ngcontent-%COMP%]{-ms-flex-align:end;align-items:flex-end}"]}),e})()},BRYv:function(e,t,a){"use strict";a.d(t,"a",function(){return o});var i=a("SVse"),s=a("593+"),r=a("8Y7J");let o=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.Yb({type:e}),e.\u0275inj=r.Xb({imports:[[i.c,s.a]]}),e})()},"NIt/":function(e,t,a){"use strict";a.d(t,"a",function(){return r});var i=a("SVse"),s=a("8Y7J");let r=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.Yb({type:e}),e.\u0275inj=s.Xb({imports:[[i.c]]}),e})()},PJha:function(e,t,a){"use strict";a.d(t,"a",function(){return l});var i=a("8Y7J"),s=a("SVse"),r=a("xvjA"),o=a("iInd"),n=a("hjD9");const c=["*"];let l=(()=>{class e{constructor(e,t,a){this.platformId=e,this.osmTileService=t,this.router=a,this.mapOptions={zoom:3,minZoom:3,maxZoom:15,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:[[-85,-180],[85,180]]},this.center=[11.89735,.852629],this.heatWindStates={heatmap:!0,wind:!0,population:!1},this.mapLoaded=new i.r,this.mapMoveStart=new i.r,this.mapMoveEnd=new i.r,this.mapResize=new i.r,this.mapClicked=new i.r,this.allLayers={heatmap:{},wind:{},basic:{},toner:{},overlay:{},population:{}},this.activeLayers={heatmap:{},wind:{},basic:{},toner:{},overlay:{},population:{}},this.activeLayerStates={basic:!1,toner:!0,population:!1,heatmap:!0,overlay:!0,wind:!0},this.resizeState=!1}ngOnInit(){}ngOnChanges(e){Object(s.B)(this.platformId)&&e.heatWindStates&&this.resolveLayerState()}ngOnDestroy(){this.allLayers.wind.layer&&(this.allLayers.wind.layer.remove(),this.allLayers.wind.layer=null)}onMapLoaded(e){this.map=e,this.resolveLayerState(),this.mapLoaded.emit(e)}onMapMoveStart(e){this.heatWindStates.wind&&(this.activeLayerStates.wind=!1,this.resolveAllLayers()),this.mapMoveStart.emit(e)}onMapMoveEnd(e){this.heatWindStates.wind&&(this.resizeState&&(this.resizeState=!1),this.activeLayerStates.wind=this.heatWindStates.wind,this.resolveAllLayers()),this.mapMoveEnd.emit(e)}onMapResize(e){this.heatWindStates.wind&&!this.resizeState&&(this.resizeState=!0,this.activeLayerStates.wind=!1,this.resolveAllLayers()),this.mapResize.emit(e)}onMapClicked(e){this.mapClicked.emit(e)}resolveLayerState(){for(const e in this.heatWindStates){const t=this.heatWindStates[e];this.activeLayerStates[e]=t,"heatmap"===e&&(this.activeLayerStates.basic=!t,this.activeLayerStates.toner=!!t,this.activeLayerStates.overlay=!!t)}(this.router.url.indexOf("/unep")>-1||this.router.url.indexOf("/osm-map")>-1)&&(this.activeLayerStates.population=!!this.heatWindStates.population),this.resolveAllLayers()}resolveAllLayers(){for(const e in this.activeLayerStates){const t=this.activeLayerStates[e],a=this.allLayers[e];t&&this.map&&(a.layer||(a.layer=this.osmTileService.generateLayer(e,this.map,a.options,null,t=>{a.layer=t,this.activateLayer(e,a)}),"wind"!==e&&this.activateLayer(e,a)),a.layer&&!this.activeLayers[e].layer&&this.activateLayer(e,a)),!t&&this.activeLayers[e].layer&&(this.activeLayers[e].layer.remove(),this.activeLayers[e].layer=null)}}activateLayer(e,t){this.allLayers[e]=Object.assign({},t),this.activeLayers[e].layer||(this.activeLayers[e]=Object.assign({},t),this.activeLayers[e].layer.addTo(this.map.mapObj))}}return e.\u0275fac=function(t){return new(t||e)(i.ac(i.J),i.ac(r.a),i.ac(o.g))},e.\u0275cmp=i.Ub({type:e,selectors:[["app-osm-heat-wind"]],inputs:{mapOptions:"mapOptions",center:"center",heatWindStates:"heatWindStates"},outputs:{mapLoaded:"mapLoaded",mapMoveStart:"mapMoveStart",mapMoveEnd:"mapMoveEnd",mapResize:"mapResize",mapClicked:"mapClicked"},features:[i.Kb],ngContentSelectors:c,decls:2,vars:2,consts:[[3,"mapOptions","center","mapLoaded","mapMoveStart","mapMoveEnd","mapResize","mapClicked"]],template:function(e,t){1&e&&(i.Ac(),i.gc(0,"app-osm-core",0),i.oc("mapLoaded",function(e){return t.onMapLoaded(e)})("mapMoveStart",function(e){return t.onMapMoveStart(e)})("mapMoveEnd",function(e){return t.onMapMoveEnd(e)})("mapResize",function(e){return t.onMapResize(e)})("mapClicked",function(e){return t.onMapClicked(e)}),i.zc(1),i.fc()),2&e&&i.Bc("mapOptions",t.mapOptions)("center",t.center)},directives:[n.a],styles:[""]}),e})()},cnTW:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var i=a("SVse"),s=a("8Y7J"),r=a("BPAf"),o=a("Ggvi");let n=(()=>{class e{constructor(e,t){this.platformId=e,this.userPref=t}isToday(e,t=this.getUserTimezone()){return this.formatDate(e,"dddd, MMM D",t)===this.formatDate(new Date,"dddd, MMM D",t)}formatDate(e,t,a){return o.a.getZonedDateTime(e,a).format(t)}getUserTimezone(){if(Object(i.B)(this.platformId))return this.userPref.timezone}}return e.\u0275fac=function(t){return new(t||e)(s.kc(s.J),s.kc(r.b))},e.\u0275prov=s.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},d3Oa:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var i=a("hl0K"),s=a("Ggvi"),r=a("8Y7J"),o=a("cnTW");let n=(()=>{class e{constructor(e){this.isTodayUtil=e,this.trans=i.a.dateShortPipe}transform(e=(new Date).toJSON(),t="h:mm, MMMM D YYYY",a,i){return e?i&&this.isTodayUtil.isToday(e,a)?this.trans.today:s.a.getZonedDateTime(e,a).format(t):null}}return e.\u0275fac=function(t){return new(t||e)(r.ac(o.a))},e.\u0275pipe=r.Zb({name:"momentDate",type:e,pure:!0}),e})()},"f/gZ":function(e,t,a){"use strict";a.d(t,"a",function(){return h});var i=a("mrSG"),s=a("KUxh"),r=a("hl0K"),o=a("XNiG"),n=a("8Y7J"),c=a("ubqS"),l=a("OQrI"),p=a("aWBA");let h=(()=>{class e{constructor(e,t,a,i){this._snackbar=e,this.leafletHelper=t,this.mapZoomService=a,this.placesLayerSelectionService=i,this.trans=r.a.portal.map.errors,this._zoomToPlace$=new o.a,this.zoomToPlace$=this._zoomToPlace$.asObservable()}findMarkerAndZoomFromId(e,t,a,s){return Object(i.a)(this,void 0,void 0,function*(){try{throw new Error("need to implement this with backend clusters")}catch(e){this._handleError(e)}})}zoomToPlace(e){this._zoomToPlace$.next(e)}_handleError(e){console.error(e);let t=this.trans.unexpectedZoomToStation;e instanceof s.b&&(t=this.trans.unableToLocateStationOnMap),this._snackbar.openSnackbar(t,"error","OK",{duration:2e3})}}return e.\u0275fac=function(t){return new(t||e)(n.kc(c.a),n.kc(s.a),n.kc(l.a),n.kc(p.a))},e.\u0275prov=n.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},hKHT:function(e,t,a){"use strict";a.d(t,"a",function(){return o});var i=a("8Y7J"),s=a("IheW"),r=a("W8+8");let o=(()=>{class e{constructor(e,t){this.http=e,this.platformId=t,this.apiUrl=Object(r.a)(),this.stationEndpoint=`${this.apiUrl}stations`,this.stationFlags={LIVECAM:"livecam",FIRES:"fires",ANALYSIS:"analysis"}}getDummyStation(){return this.http.get("/assets/json/station.json")}getStations(e,t={}){return this.http.get(`${this.stationEndpoint}/by/cityID/${e}`,{params:t})}getStationById(e,t=[]){const a={headers:new s.e({"Content-Type":"application/json"}),withCredentials:!0};let i=`${this.stationEndpoint}/${e}`;return t.length>0&&(i+=`?fields=${t.join(",")}`),this.http.get(i,a)}getMeasurement(e){return this.http.get(`${this.apiUrl}stations/${e}/measurements`)}}return e.\u0275fac=function(t){return new(t||e)(i.kc(s.b),i.kc(i.J))},e.\u0275prov=i.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},nbqv:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var i=a("SVse"),s=a("BRYv"),r=a("8Y7J");let o=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.Yb({type:e}),e.\u0275inj=r.Xb({imports:[[i.c,s.a]]}),e})(),n=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.Yb({type:e}),e.\u0275inj=r.Xb({imports:[[i.c,o]]}),e})()},"tgU/":function(e,t,a){"use strict";a.d(t,"a",function(){return c});var i=a("hl0K"),s=a("XcXF"),r=a("iq9M"),o=a("BPAf"),n=a("8Y7J");let c=(()=>{class e{constructor(e){this.userPref=e,this.trans=i.a.units,this.unitSystem=r.c.Metric,this.unitAqi=s.a.US}transform(e,t){return this.userPref&&(this.unitSystem=this.userPref.units.system,this.unitAqi=this.userPref.AQI),e===s.p.AQI?t?this.unitAqi===s.a.US?this.trans.aqiUS:this.trans.aqiCN:this.unitAqi===s.a.US?this.trans.usAqi:this.trans.cnAqi:this.unitSystem===r.c.Metric?r.b[e]:r.a[e]}}return e.\u0275fac=function(t){return new(t||e)(n.ac(o.b))},e.\u0275pipe=n.Zb({name:"units",type:e,pure:!0}),e})()},ubqS:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var i=a("8Y7J"),s=a("zHaW");let r=(()=>{class e{constructor(e){this._snackbar=e,this.SUCCESS_PANEL_CLASS="custom-snackbar__success",this.ERROR_PANEL_CLASS="custom-snackbar__error"}openSnackbar(e,t="success",a,i={}){const s="error"==t?this.ERROR_PANEL_CLASS:this.SUCCESS_PANEL_CLASS;i=Object.assign(Object.assign({},i),{panelClass:i.panelClass?`${null==i?void 0:i.panelClass} ${s}`:s}),this._snackbar.open(e,a,i)}}return e.\u0275fac=function(t){return new(t||e)(i.kc(s.a))},e.\u0275prov=i.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);